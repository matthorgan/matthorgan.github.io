<!DOCTYPE html>
<html>
  <head>
  <title>
      
          PowerShell Unexpected Character Error - Matt&#39;s Blog
      
  </title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="Matt Horgan" />
  <link rel="shortcut icon" type="image/x-icon" href="https://matthorgan.xyz/img/favicon.ico">

  
  
  
  
  
  <link rel="stylesheet" href="https://matthorgan.xyz/style.min.39acacc5d2051426f655a6b7fbf4786fbd0fd8fffd09322c9b497ef0f7439b3f.css" integrity="sha256-OaysxdIFFCb2Vaa3&#43;/R4b70P2P/9CTIsm0l&#43;8PdDmz8=">
  
  
  
  <link rel="stylesheet" href="https://matthorgan.xyz/style-dark.min.0a647fb6c07e04b77b54fa0515d0a683d39ecdb251dba960fe1f966f7ff36fc2.css" media="(prefers-color-scheme: dark)" integrity="sha256-CmR/tsB&#43;BLd7VPoFFdCmg9OezbJR26lg/h&#43;Wb3/zb8I=">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">

  
  

  <meta property="og:title" content="PowerShell Unexpected Character Error" />
<meta property="og:description" content="Over the years, I&rsquo;ve had a few different Unexpected character encountered errors in PowerShell and for the longest time, they were always a real pain to troubleshoot and looked like a bug. Once you know the issue though, it&rsquo;s a fairly simple one to solve. The latest one I&rsquo;ve come across is running the following command from our CI/CD Linux build container to a Windows 2012 machine hosted in Azure:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://matthorgan.xyz/blog/powershell-unexpected-character-error/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2023-01-05T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-01-05T00:00:00+00:00" />
<meta itemprop="name" content="PowerShell Unexpected Character Error">
<meta itemprop="description" content="Over the years, I&rsquo;ve had a few different Unexpected character encountered errors in PowerShell and for the longest time, they were always a real pain to troubleshoot and looked like a bug. Once you know the issue though, it&rsquo;s a fairly simple one to solve. The latest one I&rsquo;ve come across is running the following command from our CI/CD Linux build container to a Windows 2012 machine hosted in Azure:"><meta itemprop="datePublished" content="2023-01-05T00:00:00+00:00" />
<meta itemprop="dateModified" content="2023-01-05T00:00:00+00:00" />
<meta itemprop="wordCount" content="399">
<meta itemprop="keywords" content="powershell,automation,azure,ci/cd,devops," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:image" content="https://matthorgan.xyz/img/avatar.jpg"/>
<meta name="twitter:title" content="PowerShell Unexpected Character Error"/>
<meta name="twitter:description" content="Over the years, I&rsquo;ve had a few different Unexpected character encountered errors in PowerShell and for the longest time, they were always a real pain to troubleshoot and looked like a bug. Once you know the issue though, it&rsquo;s a fairly simple one to solve. The latest one I&rsquo;ve come across is running the following command from our CI/CD Linux build container to a Windows 2012 machine hosted in Azure:"/>

  <!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
  <![endif]-->

  <!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
  <![endif]-->

  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-112770718-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  
</head>

  <body>
    
  <h1>PowerShell Unexpected Character Error</h1>
  <header>
  
  <div class="avatar">
    <img class="avatarMask" src="https://matthorgan.xyz/img/avatar.jpg" alt="">
    <a href="https://matthorgan.xyz"><img class="avatar-border" src="https://matthorgan.xyz/img/avatar-border.svg" alt=""></a>
  </div>
  
  <h2><a class="author" href="https://matthorgan.xyz">Matt Horgan</a></h2>
</header>

  
  
  
  <p class="date">January 5, 2023</p>
  
  
  
  <div id="tags">
    <ul>
      
        
        
          <li><a href="https://matthorgan.xyz/tags/powershell/">powershell</a></li>
        
      
        
        
          <li><a href="https://matthorgan.xyz/tags/automation/">automation</a></li>
        
      
        
        
          <li><a href="https://matthorgan.xyz/tags/azure/">azure</a></li>
        
      
        
        
          <li><a href="https://matthorgan.xyz/tags/ci/cd/">ci/cd</a></li>
        
      
        
        
          <li><a href="https://matthorgan.xyz/tags/devops/">devops</a></li>
        
      
    </ul>
  </div>
  
  
  <div id="contentBody">
    <p>Over the years, I&rsquo;ve had a few different <code>Unexpected character encountered</code> errors in PowerShell and for the longest time, they were always a real pain to troubleshoot and looked like a bug. Once you know the issue though, it&rsquo;s a fairly simple one to solve. The latest one I&rsquo;ve come across is running the following command from our CI/CD Linux build container to a Windows 2012 machine hosted in Azure:</p>
<p><code>Invoke-AzVMRunCommand -ResourceGroupName $VMResourceGroupName -Name $VMName -CommandId 'RunPowerShellScript' -ScriptPath &quot;tests/gather-vm-info.ps1&quot;</code></p>
<p>The above command is using the Azure VM run command to run the contents of <code>tests/gather-vm-info.ps1</code> on the remote Windows 2012 VM. It should be noted, I was running the exact same command on Windows 2016, and Windows 2019 VMs without any issues. The error I was seeing was the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">JsonReaderException:</span> <span style="color:#960050;background-color:#1e0010">Unexpected</span> <span style="color:#960050;background-color:#1e0010">character</span> <span style="color:#960050;background-color:#1e0010">encountered</span> <span style="color:#960050;background-color:#1e0010">while</span> <span style="color:#960050;background-color:#1e0010">parsing</span> <span style="color:#960050;background-color:#1e0010">value:</span> <span style="color:#960050;background-color:#1e0010">W.</span> <span style="color:#960050;background-color:#1e0010">Path</span> <span style="color:#960050;background-color:#1e0010">&#39;&#39;,</span> <span style="color:#960050;background-color:#1e0010">line</span> <span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">,</span> <span style="color:#960050;background-color:#1e0010">position</span> <span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">.</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">ArgumentException:</span> <span style="color:#960050;background-color:#1e0010">Conversion</span> <span style="color:#960050;background-color:#1e0010">from</span> <span style="color:#960050;background-color:#1e0010">JSON</span> <span style="color:#960050;background-color:#1e0010">failed</span> <span style="color:#960050;background-color:#1e0010">with</span> <span style="color:#960050;background-color:#1e0010">error:</span> <span style="color:#960050;background-color:#1e0010">Unexpected</span> <span style="color:#960050;background-color:#1e0010">character</span> <span style="color:#960050;background-color:#1e0010">encountered</span> <span style="color:#960050;background-color:#1e0010">while</span> <span style="color:#960050;background-color:#1e0010">parsing</span> <span style="color:#960050;background-color:#1e0010">value:</span> <span style="color:#960050;background-color:#1e0010">W.</span> <span style="color:#960050;background-color:#1e0010">Path</span> <span style="color:#960050;background-color:#1e0010">&#39;&#39;,</span> <span style="color:#960050;background-color:#1e0010">line</span> <span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">,</span> <span style="color:#960050;background-color:#1e0010">position</span> <span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">.</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">at</span> <span style="color:#960050;background-color:#1e0010">&lt;ScriptBlock&gt;,</span> <span style="color:#960050;background-color:#1e0010">/builds/golden-images/tests/gather-vm-info.ps</span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#ae81ff">49</span>
</span></span></code></pre></div><p>Initially looking at this error, it felt &lsquo;buggy&rsquo; considering there was no &lsquo;W&rsquo; in my output when I ran the <code>tests/gather-vm-info.ps1</code> code individually on the VM itself. I assumed it must be an issue with the <code>Invoke-AzVMRunCommand</code> but actually, when you look closer at the output, it&rsquo;s easy to see what the issue is.</p>
<pre tabindex="0"><code>Value[0]        : 
  Code          : ComponentStatus/StdOut/succeeded
  Level         : Info
  DisplayStatus : Provisioning succeeded
  Message       : WARNING: Ping to &lt;redacted URL&gt; failed -- Status: TimedOut
{
    &#34;Output1&#34;:  true,
    &#34;Output2&#34;:  true,
    &#34;Output3&#34;:  true,
    &#34;Output4&#34;:  true,
    &#34;Output5&#34;:  false,
    &#34;Output6&#34;:  true,
    &#34;Output7&#34;:  true,
    &#34;Output8&#34;:  false,
    &#34;Output9&#34;:  false
}
</code></pre><p>As you can see, on investigating the <code>Value.Message</code> property of the object returned from <code>Invoke-AzVMRunCommand</code>, we&rsquo;ve got a warning message at the very start of the output before our custom JSON. Suddenly, the <code>W</code> character in the initial error makes sense. In our scenario, <code>Value.Message</code> returns all output including any warning messages and therefore whilst our JSON is being returned correctly, we need to ensure that any warning messages are properly handled or suppressed to ensure that our output only returns JSON ready to be converted.</p>
<p>So, the next time you see a weird unexpected parsing error, have a look at what the starting character is. If it&rsquo;s a <code>W</code>, there&rsquo;s a good chance you could be trying to parse something that has captured one of the PowerShell output streams along with your expected output.</p>

  </div>
  <footer>
  <p>
  &copy; 2020 Matt Horgan.
  Powered by <a href="https://gohugo.io/">Hugo</a>
  using the <a href="https://github.com/koirand/pulp/">pulp</a> theme.
  </p>
</footer>


  </body>
</html>
